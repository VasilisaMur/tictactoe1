<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>TicTacToe - Play</title>
</head>
<body>
<div class="container mt-2">
    <div class="container" id="main">
        <span id="turn">Tic Tac Toe</span>
        <div class="box" style="border-left: 0; border-top: 0" id="box1"></div>
        <div class="box" style="border-top: 0" id="box2"></div>
        <div class="box" style="border-top: 0; border-right: 0" id="box3"></div>
        <div class="box" style="border-left: 0" id="box4"></div>
        <div class="box" id="box5"></div>
        <div class="box" style="border-right: 0" id="box6"></div>
        <div class="box" style="border-left: 0; border-bottom: 0" id="box7"></div>
        <div class="box" style="border-bottom: 0" id="box8"></div>
        <div class="box" style="border-right: 0; border-bottom: 0" id="box9"></div>
    </div>
</div>
<style>
    .container{
	width: 330px;
	overflow: hidden;
	margin: 50px auto 0 auto;
}

.container span{
	display: block;
	text-align: center;
	font-family: sans-serif;
	font-size: 40px;
	margin-bottom: 40px;
}

.container .box{
	float: left;
	width: 100px;
	height: 100px;
	border: 1px solid #000;
	transition: all .25s ease-in-out;
	font-size: 85px;
	text-align: center;
	line-height: 100px;
	cursor: pointer;
  }

.container .box:hover{
	background: rgb(174, 244, 255);
	color: rgb(108, 108, 108);
}

.btn{
	width: 200px;
	font-weight: bold;
	cursor: pointer;
	font-size: 15px;
	display: block;
	margin: 40px auto;
	-webkit-box-shadow: 0px 0px 13px 0px rgba(0,0,0,0.75);
	-moz-box-shadow: 0px 0px 13px 0px rgba(0,0,0,0.75);
	box-shadow: 0px 0px 13px 0px rgba(0, 0, 0, 0.75);
}

.win{
	background: #48ceff;
	color: rgb(0, 94, 255);
}

</style>
<script>

    function win(){
        $.ajax("/win", {
          type: "POST",
          data: {
          }
        });
    };

    var turn = document.getElementById("turn"),
    boxes = document.querySelectorAll("#main div"), X_or_O = 0;

    function selectWinnerBoxes(b1, b2, b3) {
      b1.classList.add("win");
      b2.classList.add("win");
      b3.classList.add("win");
      turn.innerHTML = b1.innerHTML + " is a winner";
      turn.style.fontSize = "40px";
      if(b1.innerHTML === "X"){
        window.location.href = '/win';
      }else if(b1.innerHTML==="O"){
        window.location.href = '/lose';
      }
    }

    function draw(){
        window.location.href = '/draw';
    }

    function getWinner() {

        var box1 = document.getElementById("box1"),
        box2 = document.getElementById("box2"),
        box3 = document.getElementById("box3"),
        box4 = document.getElementById("box4"),
        box5 = document.getElementById("box5"),
        box6 = document.getElementById("box6"),
        box7 = document.getElementById("box7"),
        box8 = document.getElementById("box8"),
        box9 = document.getElementById("box9");

      if (box1.innerHTML !== "" && box1.innerHTML === box2.innerHTML && box1.innerHTML === box3.innerHTML)
        selectWinnerBoxes(box1, box2, box3);

      if (box4.innerHTML !== "" && box4.innerHTML === box5.innerHTML && box4.innerHTML === box6.innerHTML)
        selectWinnerBoxes(box4, box5, box6);

      if (box7.innerHTML !== "" && box7.innerHTML === box8.innerHTML && box7.innerHTML === box9.innerHTML)
        selectWinnerBoxes(box7, box8, box9);

      if (box1.innerHTML !== "" && box1.innerHTML === box4.innerHTML && box1.innerHTML === box7.innerHTML)
        selectWinnerBoxes(box1, box4, box7);

      if (box2.innerHTML !== "" && box2.innerHTML === box5.innerHTML && box2.innerHTML === box8.innerHTML)
        selectWinnerBoxes(box2, box5, box8);

      if (box3.innerHTML !== "" && box3.innerHTML === box6.innerHTML && box3.innerHTML === box9.innerHTML)
        selectWinnerBoxes(box3, box6, box9);

      if (box1.innerHTML !== "" && box1.innerHTML === box5.innerHTML && box1.innerHTML === box9.innerHTML)
        selectWinnerBoxes(box1, box5, box9);

      if (box3.innerHTML !== "" && box3.innerHTML === box5.innerHTML && box3.innerHTML === box7.innerHTML)
        selectWinnerBoxes(box3, box5, box7);

    }



    for (var i = 0; i < boxes.length; i++) {
      boxes[i].onclick = function () {
        if (this.innerHTML !== "X" && this.innerHTML !== "O") {
            this.innerHTML = "X";
            getWinner();
            check_draw();
            computer();
            check_draw();
        }
      };
    }

    function check_draw(){
        flag = true;
        for(let i = 1;i<=9;i++){
            var box = document.getElementById("box"+i);
            if(box.innerHTML === ""){
                flag = false;
                break;
            }
        }
        if(flag){
            draw();
        }
    }

    function computer(){
        let boxes = [];
        for(let i = 1;i<=9;i++){
            boxes.push(document.getElementById("box"+i));
        }

        for(;;){
            var randomChoice = Math.floor(Math.random() * (9 - 1)) + 1;
            var box = document.getElementById("box"+randomChoice);
            console.log("box"+randomChoice+" html:"+box.innerHTML);
            if(box.innerHTML === ""){
                box.innerHTML = "O";
                break;
            }
            flag = true;
            for(let i = 1;i<=9;i++){
                var box = document.getElementById("box"+i);
                if(box.innerHTML === ""){
                    flag = false;
                    break;
                }
            }
            if(flag){
                break;
            }
        }
        getWinner();
    }
</script>
</body>
</html>